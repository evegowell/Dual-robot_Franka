# Dual robot collision recovery

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”

ë³¸ í”„ë¡œì íŠ¸ëŠ” Isaac Sim 5.0.0ê³¼ ROS2 (Humble) í™˜ê²½ì—ì„œ
Franka ë¡œë´‡íŒ” 2ëŒ€ë¥¼ ë™ì¼ ì‘ì—…ê³µê°„(shared workspace) ì— ë°°ì¹˜í•˜ì—¬
ë™ì‹œì— Pick-and-Place ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì‹œìŠ¤í…œì„ êµ¬í˜„í•œë‹¤.

ë‘ ë¡œë´‡ì´ ë™ì‹œì— ì›€ì§ì´ëŠ” ê³¼ì •ì—ì„œ ì˜ˆìƒì¹˜ ëª»í•œ ì ‘ì´‰ ë˜ëŠ” ì¶©ëŒì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
ë³¸ ì—°êµ¬ì—ì„œëŠ” ì´ëŸ¬í•œ ì‹¤í–‰ ì¤‘(runtime) ì¶©ëŒì„ ê´€ì ˆ í† í¬(= ëª¨í„° ì „ë¥˜ surrogate) ê¸°ë°˜ìœ¼ë¡œ ê°ì§€í•˜ê³ ,

1. ì¦‰ì‹œ ì •ì§€ (Stop)
2. ì•ˆì „ í›„í‡´ (Back-off)
3. í™˜ê²½ ë°˜ì˜ í›„ ì¬ê³„íš (Replanning)
4. ì‘ì—… ì¬ê°œ (Resume)

ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë°˜ì‘í˜•(Reactive) ë³µêµ¬ ì‹œìŠ¤í…œì„ ì„¤ê³„í•˜ê³  ê²€ì¦í•œë‹¤.

## ğŸ¯ ì—°êµ¬ ëª©ì 

ê¸°ì¡´ì˜ ëª¨ì…˜ í”Œë˜ë‹ì€ ê³„íš ë‹¨ê³„ì—ì„œë§Œ ì¶©ëŒì„ ê³ ë ¤í•œë‹¤.
ê·¸ëŸ¬ë‚˜ ì‹¤ì œ ì‹¤í–‰ ì¤‘ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤:

- ìƒëŒ€ ë¡œë´‡ì˜ ì˜ˆìƒì¹˜ ëª»í•œ ê²½ë¡œ ì§„ì…
- ë™ì  í™˜ê²½ ë³€í™”
- ì‹¤í–‰ ì˜¤ì°¨

ë³¸ í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒ ì§ˆë¬¸ì— ë‹µí•˜ê³ ì í•œë‹¤:

ì‹¤í–‰ ì¤‘ ë°œìƒí•˜ëŠ” ì¶©ëŒì„ ê´€ì ˆ í† í¬ ì‹ í˜¸ë§Œìœ¼ë¡œ ê°ì§€í•˜ê³ ,
ë‘ ë¡œë´‡ì´ ì•ˆì „í•˜ê²Œ ì‘ì—…ì„ ë³µêµ¬í•  ìˆ˜ ìˆëŠ”ê°€?

## ğŸ§  ì—°êµ¬ ê¸°ì—¬ì  (Contributions)
1ï¸âƒ£ í† í¬ ê¸°ë°˜ ì¶©ëŒ ì´ë²¤íŠ¸ ê°ì§€ê¸° ì„¤ê³„

- ê´€ì ˆ effortë¥¼ ì „ë¥˜ì˜ surrogateë¡œ ì‚¬ìš©
- Isaac Simì˜ contact ground truthì™€ ë¹„êµ
- Precision / Recall / Detection Delay ë¶„ì„

2ï¸âƒ£ ë°˜ì‘í˜• ë³µêµ¬ ì •ì±… ì„¤ê³„

- Stop â†’ Back-off â†’ Replan â†’ Resume
- ë™ì  ì¥ì• ë¬¼ ë°˜ì˜

3ï¸âƒ£ ì •ëŸ‰ì  ì„±ëŠ¥ ë¹„êµ

- Baseline (ì •ì  ê³„íš)
- Proposed (ì¶©ëŒ ê°ì§€ + ì¬ê³„íš)
- ì„±ê³µë¥  / ì‘ì—… ì‹œê°„ / ì¶©ëŒ íšŸìˆ˜ ë¹„êµ

## ğŸ— ì‹œìŠ¤í…œ êµ¬ì¡°

Isaac Sim 5.0.0
     
      â†“ (ROS2 Bridge)
ROS2 Humble 

      â”œâ”€â”€ MoveIt2 (Planning)
      â”œâ”€â”€ Torque Monitor Node
      â”œâ”€â”€ Recovery FSM Node
      â””â”€â”€ Task Execution Node
## ğŸ¤– ì‘ì—…(Task) ì„¤ëª…
### Shared Workspace Dual Pick-and-Place

- Franka ë¡œë´‡ 2ëŒ€
- ì¤‘ì•™ í…Œì´ë¸” 1ê°œ
- íë¸Œ 6ê°œ ëœë¤ ë°°ì¹˜
- Robot A â†’ ì™¼ìª½ binìœ¼ë¡œ ì´ë™
- Robot B â†’ ì˜¤ë¥¸ìª½ binìœ¼ë¡œ ì´ë™
- ë‘ ë¡œë´‡ ë™ì‹œ ì‹¤í–‰
- ì¤‘ì•™ ì˜ì—­ ê²¹ì¹¨ â†’ ì¶©ëŒ ìœ ë„

## âš™ï¸ ë¡œë´‡ ìƒíƒœê¸°ê³„ (FSM)

ê° ë¡œë´‡ì€ ë‹¤ìŒ ìƒíƒœë¥¼ ê°€ì§„ë‹¤:

- IDLE
- PLAN
- EXECUTE
- COLLISION_STOP
- BACKOFF
- REPLAN
- DONE / FAIL

## ğŸ” ì¶©ëŒ ê°ì§€ ë¡œì§

ê¸°ë³¸ í† í¬ ê¸°ë°˜ ê°ì§€ ê·œì¹™:

s(t) = max_i |tau_i(t)|

if s(t) > T for K consecutive ticks:
    collision_event = True

ì˜µì…˜(ì˜¤íƒ ê°ì†Œ):

T(t) = T0 + k * max_i |dq_i(t)|

ì¦‰, ì†ë„ ê¸°ë°˜ ì ì‘ ì„ê³„ì¹˜ ì ìš© ê°€ëŠ¥.

## ğŸ“Š ì‹¤í—˜ ì„¤ê³„
ë¹„êµêµ°
Baseline

ì •ì  ê³„íš

ì¶©ëŒ ì‹œ ë‹¨ìˆœ ì •ì§€ ë˜ëŠ” ì‹¤íŒ¨ ì²˜ë¦¬

Proposed

ì¶©ëŒ ê°ì§€

Back-off ìˆ˜í–‰

ì¬ê³„íš í›„ ì‘ì—… ì¬ê°œ

í‰ê°€ ì§€í‘œ

ì‘ì—… ì„±ê³µë¥  (%)

í‰ê·  ì‘ì—… ì™„ë£Œ ì‹œê°„

Ground truth ì¶©ëŒ íšŸìˆ˜

ì¬ê³„íš íšŸìˆ˜

ì¶©ëŒ í›„ íšŒë³µ ì„±ê³µë¥ 

ì¶©ëŒ ê°ì§€ Precision / Recall

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

dual_franka_replan/
â”‚
â”œâ”€â”€ README.md
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ scene.yaml
â”‚   â”œâ”€â”€ thresholds.yaml
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ run_experiment.py
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ sim_env.py
â”‚   â”œâ”€â”€ robot_interface.py
â”‚   â”œâ”€â”€ planner_interface.py
â”‚   â”œâ”€â”€ collision_monitor.py
â”‚   â”œâ”€â”€ fsm_controller.py
â”‚   â””â”€â”€ metrics.py
â”‚
â””â”€â”€ logs/
    â”œâ”€â”€ trial_0001.csv
    â””â”€â”€ trial_0001_meta.json

## ğŸ§ª ML ì ìš© ê°€ëŠ¥ ì˜ì—­ (ì„ íƒ ì‚¬í•­)
### 1ï¸âƒ£ í† í¬ ê¸°ë°˜ ì¶©ëŒ ë¶„ë¥˜ê¸°

ì…ë ¥: ìµœê·¼ 0.2~0.5ì´ˆ í† í¬/ì†ë„ ì‹œê³„ì—´

ì¶œë ¥: contact / no-contact

ëª¨ë¸: RandomForest / XGBoost / 1D-CNN

ë¼ë²¨: contact ground truth ìë™ ìƒì„±

### 2ï¸âƒ£ Replan íŠ¸ë¦¬ê±° ìµœì í™”

ë¶ˆí•„ìš”í•œ ì¬ê³„íš ê°ì†Œ

ì˜¤íƒ ì¤„ì´ê¸°

## ğŸš€ ê°œë°œ ë‹¨ê³„ ì²´í¬ë¦¬ìŠ¤íŠ¸
### Step 1

Franka 2ëŒ€ ìŠ¤í°

ROS2 joint_states í™•ì¸

### Step 2

Franka 1ëŒ€ë¡œ Pick-and-Place ì„±ê³µ

### Step 3

ë‘ ë¡œë´‡ ë™ì‹œ ì‹¤í–‰

ì¶©ëŒ ë°œìƒ ìƒí™© ìƒì„±

### Step 4

í† í¬ ë° contact ë¡œê·¸ ê¸°ë¡

### Step 5

í† í¬ ì„ê³„ì¹˜ ê¸°ë°˜ Stop êµ¬í˜„

### Step 6

Back-off ë™ì‘ ì¶”ê°€

### Step 7

Replan + Resume êµ¬í˜„

## ğŸ–¥ í™˜ê²½

OS: Ubuntu 22.04

ROS2: Humble

Isaac Sim: 5.0.0

GPU: RTX 2070 ì´ìƒ ê¶Œì¥

## ğŸ“Œ ìµœì¢… ëª©í‘œ

Dual-arm shared workspace ì‹œë®¬ë ˆì´ì…˜ í™˜ê²½ êµ¬ì¶•

ì‹¤í–‰ ì¤‘ ì¶©ëŒ ê°ì§€ + ì¬ê³„íš ì‹œìŠ¤í…œ êµ¬í˜„

Baseline ëŒ€ë¹„ ì„±ëŠ¥ ê°œì„  ì •ëŸ‰ ê²€ì¦

ì¬í˜„ ê°€ëŠ¥í•œ ì‹¤í—˜ í™˜ê²½ ë° ë¡œê·¸ ì œê³µ